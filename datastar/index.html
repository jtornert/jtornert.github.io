<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Datastar</title>
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <link rel="stylesheet" href="/reset/reset.css" />
    <link rel="stylesheet" href="/reset/utilities.css" />
    <link rel="stylesheet" href="style.css" />
    <script
            type="module"
            src="https://cdn.jsdelivr.net/gh/starfederation/datastar@main/bundles/datastar.js"></script>
    <script type="module" src="components.js"></script>
    <script>
        function sleep(duration) {
            return new Promise(res => setTimeout(() => {
                res();
            }, duration));
        }

        function renderTemplate(id, args) {
            const template = document.getElementById(id).cloneNode(true);

            for (const key in args) {
                template.innerHTML = template.innerHTML.replace(`{{${key}}}`, args[key]);
            }

            return template.innerHTML.trim();
        }

        async function sendEvent(type, detail) {
            document.dispatchEvent(new CustomEvent("datastar-fetch", { detail: { type, argsRaw: detail } }));
        }

        async function mockget(url) {
            const sendElement = (i) => {
                sendEvent("datastar-patch-elements", {
                    elements: renderTemplate("messages", { index: i, hash: Math.random().toString(36).slice(2) })
                });
            };

            sendElement(1);
            for (let i = 1; i < 100; ++i) {
                await sleep(10);
                sendElement(i + 1);
            }
        }
    </script>
</head>

<body>
    <div id="root" class="print-width" style="margin-bottom: 4rem;">
        <h1 data-font-size="large6">Datastar ðŸš€</h1>

        <h2 data-font-size="large3">Load HTML</h2>
        <p>Click this button to load a response with HTML:</p>
        <button class="button" data-on-click="@get('responses/markup.html')">Load HTML</button>
        <p>Message:
            <span id="response-html"><span class="weak">Datastar responses will be displayed here.</span></span>
        </p>
        <p>Click this button to generate 100 element updates 10 milliseconds apart:</p>
        <button class="button" data-on-click="mockget('/messages')">Generate messages</button>

        <h2 data-font-size="large3">Backend-synced signals</h2>
        <h3 data-font-size="large1">Counter</h3>
        <p>Click this button to increment the counter inside the browser only:</p>
        <button
                class="button tabular"
                style="width: 100%"
                data-signals="{_count: 0}"
                data-text="$_count"
                data-on-click="++$_count"></button>
        <p>Click this button to sync the counter with the backend (15):</p>
        <button class="button" data-on-click="@get('responses/set-counter.json')">Sync</button>

        <h3 data-font-size="large1">Show and hide</h3>
        <p>Click this button to toggle the panel below:</p>
        <button class="button" data-on-click="$_visible = !$_visible">Toggle panel</button>
        <p data-show="$_visible">I'm hiding in plain sight</p>
        <p>Click this button to make the backend force show the panel:</p>
        <button class="button" data-on-click="@get('responses/show-panel.json')">Show panel via backend</button>

        <h2 data-font-size="large3">Custom elements</h2>
        <p>Choose an option in the menu and see the input update:</p>
        <ui-menu data-on-ui:itemselect="evt.target.value && ($_value = evt.target.value)">
            <button class="button" data-ui="menu.trigger">Menu <ui-icon icon="chevron"></ui-icon></button>
            <ui-popover data-ui="menu.popover">
                <menu role="menu">
                    <li><button data-ui="menu.item" value="1" disabled>Option 1</button></li>
                    <li><a href="#" data-ui="menu.item">Link</a></li>
                    <li><button data-ui="menu.item" value="2">Option 2</button></li>
                    <li><button data-ui="menu.item" value="3">Option 3</button></li>
                    <li>
                        <button data-ui="menu.submenu">
                            Submenu <ui-icon icon="chevron" style="rotate: -90deg"></ui-icon>
                        </button>
                        <ui-popover data-ui="menu.popover">
                            <menu role="menu">
                                <li><button data-ui="menu.item" value="4">Option 4</button></li>
                                <li><button data-ui="menu.item" value="5">Option 5</button></li>
                                <li>
                                    <button data-ui="menu.submenu">
                                        Submenu <ui-icon icon="chevron" style="rotate: -90deg"></ui-icon>
                                    </button>
                                    <ui-popover data-ui="menu.popover">
                                        <menu role="menu">
                                            <li><button data-ui="menu.item" value="6">Option 6</button></li>
                                            <li><button data-ui="menu.item" value="7">Option 7</button></li>
                                            <li><button data-ui="menu.item" value="8">Option 8</button></li>
                                        </menu>
                                    </ui-popover>
                                </li>
                            </menu>
                        </ui-popover>
                    </li>
                </menu>
            </ui-popover>
        </ui-menu>
        <input class="textfield" type="text" data-bind="_value" />
    </div>
    <div id="overlay"></div>
    <template id="messages">
        <span id="response-html">Generated #{{index}}: {{hash}}</span>
    </template>
</body>

</html>