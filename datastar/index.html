<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Datastar</title>
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <link rel="stylesheet" href="/reset/reset.css" />
    <link rel="stylesheet" href="/reset/utilities.css" />
    <link rel="stylesheet" href="style.css" />
    <script type="module" src="plugins.js"></script>
    <script type="module" src="components.js"></script>
    <style>
        :root {
            --animation-duration-in: 150ms;
            --animation-duration-out: 75ms;
            --animation-delay-flip: 25ms;
        }

        #notifications {
            position: relative;
            list-style: none;
            padding: 0;
            height: 10rem;
            overflow-x: hidden;
            overflow-y: scroll;
        }

        .notification {
            display: grid;
            grid-template-columns: 1fr auto;
            max-width: 30ch;
        }

        .entering {
            animation: enter var(--animation-duration-in) linear forwards;
            pointer-events: none;
        }

        .leaving {
            animation: leave var(--animation-duration-out) linear forwards;
            pointer-events: none;
            position: absolute;
        }

        .flipping {
            animation: flip var(--animation-duration-out) var(--animation-delay-flip) linear backwards;
        }

        @keyframes leave {
            to {
                opacity: 0;
                translate: 100px;
                transform-origin: center;
            }
        }

        @keyframes enter {
            from {
                opacity: 0;
                translate: 100px;
                transform-origin: center;
            }
        }

        @keyframes flip {
            from {
                translate: var(--flip-x, 0px) var(--flip-y, 0px);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            :root {
                --animation-duration-in: 0ms;
                --animation-duration-out: 0ms;
                --animation-delay-flip: 0ms;
            }
        }
    </style>
    <script>
        function sendNotification() {
            notifications.append(notification.content.cloneNode(true));
        }

        function handleNotificationAnimationEnd(evt, el) {
            switch (evt.animationName) {
                case "enter":
                    el.classList.remove("entering");
                    break;
                case "leave":
                    el.remove();
                    break;
                case "flip":
                    for (const li of notifications.querySelectorAll(".flipping")) {
                        li.classList.remove("flipping");
                        li.style.removeProperty("--flip-y");
                    }
                    break;

                default:
                    break;
            }
        }

        function handleNotificationDismiss(evt, el) {
            const li = el.closest("li");
            const remainder = Array.prototype.slice.call(notifications.children, Array.prototype.indexOf.call(notifications.children, li) + 1);
            const next = remainder[0]?.getBoundingClientRect();
            const rect = li.getBoundingClientRect();
            for (const child of remainder) {
                child.classList.add("flipping");
                child.style.setProperty("--flip-y", `${next.y - rect.y}px`);
            }
            li.classList.add('leaving');
            li.style.width = `${rect.width}px`;
            li.style.height = `${rect.height}px`;
        }
    </script>
</head>

<body data-init="@get(location.pathname)">
    <div id="root" class="print-width" style="margin-bottom: 4rem;">
        <h1 data-font-size="large6">Datastar ðŸš€</h1>

        <h2 data-font-size="large3">Load HTML</h2>
        <p>Click this button to load a response with HTML:</p>
        <button class="button" data-on:click="@get('responses/markup.html')">Load HTML</button>
        <p>Message:
            <span id="response-html"><span class="weak">Datastar responses will be displayed here.</span></span>
        </p>
        <p>Click this button to generate 100 element updates 10 milliseconds apart:</p>
        <button class="button" data-on:click="@get('/messages')">Generate messages</button>

        <h2 data-font-size="large3">Backend-synced signals</h2>
        <h3 data-font-size="large1">Counter</h3>
        <p>Click this button to increment the counter inside the browser only:</p>
        <button
                class="button tabular"
                style="width: 100%"
                data-signals="{_count: 0}"
                data-text="$_count"
                data-on:click="++$_count"></button>
        <p>Click this button to sync the counter with the backend (15):</p>
        <button class="button" data-on:click="@get('responses/set-counter.json')">Sync</button>

        <h3 data-font-size="large1">Show and hide</h3>
        <p>Click this button to toggle the panel below:</p>
        <button class="button" data-on:click="$_visible = !$_visible">Toggle panel</button>
        <p data-show="$_visible">I'm hiding in plain sight</p>
        <p>Click this button to make the backend force show the panel:</p>
        <button class="button" data-on:click="@get('responses/show-panel.json')">Show panel via backend</button>

        <h2 data-font-size="large3">Custom plugins</h2>
        <p>Click this button to generate a new timestamp and display it in your own timezone and locale:</p>
        <button class="button" data-on:click="@get('/timestamp')">Generate timestamp</button>
        <ul id="timestamps"></ul>

        <h2 data-font-size="large3">Custom elements</h2>
        <p>Choose an option in the menu and see the input update:</p>
        <ui-menu data-on:ui:itemselect="evt.target.value && ($_value = evt.target.value)">
            <button class="button" data-ui="menu.trigger">Menu <ui-icon icon="chevron"></ui-icon></button>
            <ui-popover data-ui="menu.popover">
                <menu role="menu">
                    <li><button data-ui="menu.item" value="1" disabled>Option 1</button></li>
                    <li><a href="#" data-ui="menu.item">Link</a></li>
                    <li><button data-ui="menu.item" value="2">Option 2</button></li>
                    <li><button data-ui="menu.item" value="3">Option 3</button></li>
                    <li>
                        <button data-ui="menu.submenu">
                            Submenu <ui-icon icon="chevron" style="rotate: -90deg"></ui-icon>
                        </button>
                        <ui-popover data-ui="menu.popover">
                            <menu role="menu">
                                <li><button data-ui="menu.item" value="4">Option 4</button></li>
                                <li><button data-ui="menu.item" value="5">Option 5</button></li>
                                <li>
                                    <button data-ui="menu.submenu">
                                        Submenu <ui-icon icon="chevron" style="rotate: -90deg"></ui-icon>
                                    </button>
                                    <ui-popover data-ui="menu.popover">
                                        <menu role="menu">
                                            <li><button data-ui="menu.item" value="6">Option 6</button></li>
                                            <li><button data-ui="menu.item" value="7">Option 7</button></li>
                                            <li><button data-ui="menu.item" value="8">Option 8</button></li>
                                        </menu>
                                    </ui-popover>
                                </li>
                            </menu>
                        </ui-popover>
                    </li>
                </menu>
            </ui-popover>
        </ui-menu>
        <input class="textfield" type="text" data-bind="_value" />
        <h2 data-font-size="large3">Prototyping</h2>
        <p>
            This page contains mocked API routes for handling datastar fetching. This allows us to create prototypes
            directly in the browser which are then easily adapted for a real API.
        </p>
        <p>This task list is persisted in <code class="code">localStorage</code> to simulate database operations.</p>
        <form style="display: flex;align-items: baseline;gap: 0.25rem;"
              data-on:submit="$title.trim() && @post('/todo')">
            <input class="textfield" type="text" placeholder="Add task..." data-bind:title>
            <button class="button" type="submit">+ Add</button>
            <small data-text="`Tasks: ${$_length}`"></small>
        </form>
        <ul id="tasklist" data-on:click="@handleClick()" data-on:change="@handleChange()"></ul>
        <h2 data-font-size="large3">FLIP Animations</h2>
        <p>Click this button to add an animated element to the list:</p>
        <button data-on:click="sendNotification()">Add element</button>
        <ul id="notifications"></ul>
    </div>
    <div id="overlay"></div>
    <template id="task">
        <li id="{{id}}">
            <input class="textfield" type="text" name="title" value="{{title}}">
            <input class="checkbox" type="checkbox" name="completed" data-attr:checked="{{completed}}">
            <button class="button" data-action="delete"></button>
        </li>
    </template>
    <template id="messages">
        <span id="response-html">Generated #{{index}}: {{hash}}</span>
    </template>
    <template id="timestamp">
        <li style="display: flex;justify-content: space-between;">
            <span>
                <time data-time__date.medium__time.medium="{{timestamp}}"></time>
                -
                <time data-time__relative="{{timestamp}}"></time>
            </span>
            <span style="display: flex;gap: 0.25rem;">
                <button class="button" style="padding: 0;" onclick="this.firstElementChild.classList.toggle('checked')">
                    <ui-icon icon="heart"></ui-icon>
                </button>
                <button class="button" style="padding: 0;" onclick="this.closest('li').remove()">
                    <ui-icon icon="cross"></ui-icon>
                </button>
            </span>
        </li>
    </template>
    <template id="notification">
        <li class="notification entering"
            data-on:animationend="handleNotificationAnimationEnd(evt, el)">
            <span data-text="Math.random()"></span>
            <button
                    data-on:click="handleNotificationDismiss(evt, el)">&cross;</button>
        </li>
    </template>
</body>

</html>